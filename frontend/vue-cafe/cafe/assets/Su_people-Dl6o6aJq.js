import{d as U,r as m,c as u,o as $,j,b as n,e as a,f as B,t as o,F as h,n as y,i as l,p as z,l as b,_ as D}from"./index-B6v4qw03.js";const I={class:"content"},T={key:0,class:"status-message"},V={class:"filter-switch",role:"tablist","aria-label":"Filtrer les utilisateurs"},O=["onClick"],P={class:"cards-grid"},q={key:0,class:"muted"},M={key:1,class:"error-text"},G={key:2,class:"muted"},H={key:3,class:"user-list"},J={class:"user-name"},K=["href"],Q=U({__name:"Su_people",setup(R){const c=m([]),f=m(!1),i=m(null),p=m("teachers"),S=[{key:"teachers",label:"Professeurs"},{key:"students",label:"Élèves"},{key:"superusers",label:"Superusers"}],k=e=>{if(typeof e=="boolean")return e;if(typeof e=="number")return e!==0;if(typeof e=="string"){const t=e.trim().toLowerCase();return t==="true"||t==="1"||t==="oui"}return!1},g=e=>{const t=e.mail??e.email??"";return String(t).trim()||"Email inconnu"},C=e=>{const t=e.nom??e.last_name??"",s=e.prenom??e.first_name??"",r=e.login??"",d=`${s} ${t}`.trim();return d||(r?String(r):"Nom inconnu")},_=e=>{const t=e.superuser??e.is_superuser??e.isSuperuser;return k(t)},v=e=>{const t=String(e.droit??e.role??e.right??"").toLowerCase();if(t.includes("prof")||t.includes("enseignant")||t.includes("teacher"))return!0;const s=e.teacher??e.is_teacher??e.isTeacher;return k(s)},w=e=>{const t=e.droit??e.role??e.right;return t?String(t):_(e)?"superuser":v(e)?"prof":"eleve"},A=u(()=>c.value.filter(e=>v(e))),L=u(()=>c.value.filter(e=>_(e))),x=u(()=>c.value.filter(e=>!v(e)&&!_(e))),F=u(()=>[{key:"teachers",title:"Professeurs",users:A.value,emptyLabel:"Aucun professeur trouvé."},{key:"students",title:"Élèves",users:x.value,emptyLabel:"Aucun élève trouvé."},{key:"superusers",title:"Superusers",users:L.value,emptyLabel:"Aucun superuser trouvé."}]),N=u(()=>F.value.filter(e=>e.key===p.value));$(async()=>{f.value=!0,i.value=null;const e=typeof window<"u"?window.localStorage.getItem("cafe_token"):null;if(!e){i.value="Authentification requise pour accéder à la liste des utilisateurs.",f.value=!1;return}try{const t=await j(e);c.value=E(t)}catch(t){console.error("Failed to fetch users list",t),i.value="Impossible de récupérer la liste des utilisateurs."}finally{f.value=!1}});function E(e){return e?Array.isArray(e)?e:typeof e=="object"?Object.entries(e).map(([t,s])=>({login:t,...s??{}})):[]:[]}return(e,t)=>(l(),n("section",I,[t[0]||(t[0]=a("header",{class:"major"},[a("h1",null,"Espace Superuser"),a("p",null,"Actions réservées aux administrateurs de la plateforme CAFE.")],-1)),i.value?(l(),n("p",T,o(i.value),1)):B("",!0),a("div",V,[(l(),n(h,null,y(S,s=>a("button",{key:s.key,type:"button",class:z(["filter-button",{active:s.key===p.value}]),onClick:r=>p.value=s.key},o(s.label),11,O)),64))]),a("div",P,[(l(!0),n(h,null,y(N.value,s=>(l(),n("article",{key:s.key,class:"card"},[a("h2",null,o(s.title),1),f.value?(l(),n("p",q,"Chargement en cours…")):i.value?(l(),n("p",M,o(i.value),1)):s.users.length===0?(l(),n("p",G,o(s.emptyLabel),1)):(l(),n("ul",H,[(l(!0),n(h,null,y(s.users,(r,d)=>(l(),n("li",{key:r.login??r.email??r.mail??`${s.key}-${d}`,class:"user-item"},[a("span",J,[b(o(C(r))+" ",1),a("a",{href:"mailto:"+g(r)},o(g(r)),9,K),b(" Droit : "+o(w(r)),1)])]))),128))]))]))),128))])]))}}),X=D(Q,[["__scopeId","data-v-3609c39d"]]);export{X as default};
