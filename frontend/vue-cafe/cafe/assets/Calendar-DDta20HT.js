import{i as h,a as k,b as _,c as C,d as L,F as x}from"./index-DmXsHafB.js";import{d as S,r as d,c as U,o as R,a as w,b as s,e,f as i,g as E,t as a,u as I,h as B,i as o,_ as F}from"./index-B6v4qw03.js";const O={class:"content kawa-page"},D={class:"calendar-actions"},j=["disabled"],G={key:0,class:"calendar-hint"},M={key:0,class:"calendar-status error"},P={key:2,class:"calendar-status empty"},$={key:3,class:"event-details"},V={key:0},N={key:1},T="get_all",W=S({__name:"Calendar",setup(q){const u=d(!1),c=d(null),n=d(null),p=d(null),v=d(null);let r=null;const f=U(()=>v.value?{plugins:[h,k,_,C,L],initialView:"dayGridMonth",headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},locale:"fr",height:"auto",navLinks:!0,selectable:!0,eventClick:g,eventSources:[{id:"psee-ics",url:"https://cafe.zpq.ens-paris-saclay.fr/api/ics/get_all",format:"ics"}]}:null);function b(t){return t?t.toLocaleString("fr-FR",{weekday:"long",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}function g(t){n.value={title:t.event.title,start:t.event.start,end:t.event.end,description:t.event.extendedProps?.description,location:t.event.extendedProps?.location}}async function y(){u.value=!0,c.value=null,n.value=null;try{const t=await B(T),l=typeof t=="string"?t:t?.ics??t?.content??JSON.stringify(t);if(!l||l.length<10)throw new Error("Flux ICS vide pour la promo sélectionnée.");r&&URL.revokeObjectURL(r);const m=new Blob([l],{type:"text/calendar"});console.log("ICS Blob created:",m),r=URL.createObjectURL(m),v.value=r,console.log("ICS URL loaded:",v.value),p.value=new Date().toLocaleTimeString("fr-FR")}catch(t){console.error("Unable to load ICS feed",t),c.value="Impossible de charger le calendrier PSEE pour le moment.",v.value=null}finally{u.value=!1}}return R(()=>{y()}),w(()=>{r&&URL.revokeObjectURL(r)}),(t,l)=>(o(),s("section",O,[l[5]||(l[5]=e("header",{class:"major"},[e("h1",null,"Calendriers"),e("p",null,"Visualisation du calendrier PSEE")],-1)),e("div",D,[e("button",{type:"button",class:"button primary small",disabled:u.value,onClick:y},a(u.value?"Chargement…":"Rafraîchir"),9,j),p.value?(o(),s("span",G," Mis à jour à "+a(p.value),1)):i("",!0)]),c.value?(o(),s("p",M,a(c.value),1)):i("",!0),f.value?(o(),E(I(x),{key:1,class:"calendar-widget",options:f.value},null,8,["options"])):u.value?i("",!0):(o(),s("p",P," Impossible d’afficher le calendrier pour le moment. ")),n.value?(o(),s("div",$,[e("header",null,[e("h2",null,a(n.value.title),1),e("button",{class:"link-button",type:"button",onClick:l[0]||(l[0]=m=>n.value=null)},"Fermer")]),e("dl",null,[e("div",null,[l[1]||(l[1]=e("dt",null,"Début",-1)),e("dd",null,a(b(n.value.start)),1)]),e("div",null,[l[2]||(l[2]=e("dt",null,"Fin",-1)),e("dd",null,a(b(n.value.end)),1)]),n.value.location?(o(),s("div",V,[l[3]||(l[3]=e("dt",null,"Lieu",-1)),e("dd",null,a(n.value.location),1)])):i("",!0),n.value.description?(o(),s("div",N,[l[4]||(l[4]=e("dt",null,"Description",-1)),e("dd",null,a(n.value.description),1)])):i("",!0)])])):i("",!0)]))}}),A=F(W,[["__scopeId","data-v-7c5b561f"]]);export{A as default};
