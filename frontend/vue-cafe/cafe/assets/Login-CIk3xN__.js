import{d as b,y as x,r as u,b as d,e as s,f as k,q as p,z as c,t as m,A as C,p as I,C as S,D as h,E as A,G as f,H as E,i as g,_ as U}from"./index-B6v4qw03.js";const V={class:"content"},z={class:"row gtr-50 gtr-uniform"},M={class:"col-12"},q={class:"col-12"},B={class:"actions"},D=["disabled"],j=b({__name:"Login",setup(L){const v=E(),a=x({login:"",password:""}),r=u(!1),n=u(null);function _(o){return o&&typeof o=="object"&&"response"in o&&o.response?.data?.detail?o.response.data.detail:o instanceof Error?o.message:"Connexion impossible pour le moment."}async function w(){if(!r.value){r.value=!0,n.value=null;try{const{data:o}=await S({username:a.login,password:a.password});n.value={type:"success",message:"Connexion réussie, redirection…"},a.password="";const e=o.access_token,t=await h(e);localStorage.setItem("cafe_token",e);const l=Array.isArray(t)&&t.length>0?t[0]:t,i=l?A(l):null;localStorage.setItem("cafe_superuser",i?.superuser?"true":"false"),f({token:e,superuser:i?.superuser??!1});const y=l?.login??"profil";await v.push({name:"user-detail",params:{id:y}})}catch(o){n.value={type:"error",message:_(o)},localStorage.removeItem("cafe_superuser"),f({token:null,superuser:!1})}finally{r.value=!1}}}return(o,e)=>(g(),d("section",V,[e[5]||(e[5]=s("header",{class:"major"},[s("h1",null,"Connexion"),s("p",null,"Identifiez-vous pour accéder à votre espace CAFE.")],-1)),s("form",{class:"login-form",onSubmit:C(w,["prevent"])},[s("div",z,[s("div",M,[e[2]||(e[2]=s("label",{for:"login"},"Identifiant",-1)),p(s("input",{id:"login","onUpdate:modelValue":e[0]||(e[0]=t=>a.login=t),type:"text",required:"",autocomplete:"username",placeholder:"ex : prenom.nom"},null,512),[[c,a.login,void 0,{trim:!0}]])]),s("div",q,[e[3]||(e[3]=s("label",{for:"password"},"Mot de passe",-1)),p(s("input",{id:"password","onUpdate:modelValue":e[1]||(e[1]=t=>a.password=t),type:"password",required:"",autocomplete:"current-password",placeholder:"Votre mot de passe"},null,512),[[c,a.password]])])]),e[4]||(e[4]=s("p",null,null,-1)),s("ul",B,[s("li",null,[s("button",{type:"submit",class:"button primary",disabled:r.value},m(r.value?"Connexion…":"Se connecter"),9,D)])])],32),n.value?(g(),d("p",{key:0,class:I(["form-feedback",n.value.type]),role:"status"},m(n.value.message),3)):k("",!0)]))}}),F=U(j,[["__scopeId","data-v-f039d26f"]]);export{F as default};
